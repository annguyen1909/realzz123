{"ast":null,"code":"import { GLOBALTYPES } from \"./globalTypes\";\nimport { imageUpload } from \"../../utils/imgUpload\";\nimport { getDataAPI, postDataAPI, patchDataAPI, deleteDataAPI } from \"../../utils/fetchData\";\nimport axios from \"axios\";\nexport const POST_TYPES = {\n  CREATE_POST: 'CREATE_POST',\n  LOADING_POST: 'LOADING_POST',\n  GET_POSTS: 'GET_POSTS',\n  UPDATE_POST: 'UPDATE_POST',\n  GET_POST: 'GET_POST',\n  DELETE_POST: 'DELETE_POST'\n};\nexport const createPost = (data, images, auth) => async dispatch => {\n  // console.log({data, images}, auth)\n  let media = [];\n\n  try {\n    dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: {\n        loading: true\n      }\n    });\n    if (images.length > 0) media = await imageUpload(images, auth.token);\n    const newData = { ...data,\n      images: media\n    };\n    const res = await postDataAPI('posts', newData, auth.token);\n    dispatch({\n      type: POST_TYPES.CREATE_POST,\n      payload: { ...res.data.newPost,\n        user: auth.user\n      }\n    });\n    dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: {\n        loading: false\n      }\n    });\n    dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: {\n        success: res.data.msg\n      }\n    });\n  } catch (err) {\n    dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: {\n        error: err.response.data.msg\n      }\n    });\n  }\n};\nexport const getPosts = token => async dispatch => {\n  try {\n    dispatch({\n      type: POST_TYPES.LOADING_POST,\n      payload: {\n        loading: true\n      }\n    });\n    const res = await getDataAPI('posts', token);\n    dispatch({\n      type: POST_TYPES.GET_POSTS,\n      payload: res.data\n    });\n    dispatch({\n      type: POST_TYPES.LOADING_POST,\n      payload: {\n        loading: false\n      }\n    });\n  } catch (err) {\n    dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: {\n        error: err.response.data.msg\n      }\n    });\n  }\n};\nexport const getAllPosts = () => async dispatch => {\n  try {\n    dispatch({\n      type: POST_TYPES.LOADING_POST,\n      payload: {\n        loading: true\n      }\n    });\n    const res = await axios.get(`/api/allposts`);\n    dispatch({\n      type: POST_TYPES.GET_POSTS,\n      payload: res.data\n    });\n    dispatch({\n      type: POST_TYPES.LOADING_POST,\n      payload: {\n        loading: false\n      }\n    });\n  } catch (err) {\n    dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: {\n        error: err.response.data.msg\n      }\n    });\n  }\n};\nexport const updatePost = (data, images, auth, status) => async dispatch => {\n  let media = [];\n  const imgNewURL = images.filter(img => !img.url);\n  const imgOldURL = images.filter(img => img.url);\n  if (status === data && imgNewURL.length === 0 && imgOldURL.length === status.images.length) return;\n\n  try {\n    dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: {\n        loading: true\n      }\n    });\n    if (imgNewURL.length > 0) media = await imageUpload(imgNewURL, auth.token);\n    const newData = { ...data,\n      images: [...imgOldURL, ...media]\n    };\n    const res = await patchDataAPI(`post/${status._id}`, newData, auth.token);\n    console.log(res); // dispatch({ \n    //     type: POST_TYPES.UPDATE_POST, \n    //     payload: {...res.data.newPost, user: auth.user} \n    // })\n    // dispatch({ type: GLOBALTYPES.ALERT, payload: {loading: false} })\n    // dispatch({\n    //     type: GLOBALTYPES.ALERT, \n    //     payload: ({\n    //         success: res.data.msg\n    //     })\n    // })\n  } catch (err) {\n    dispatch({\n      type: GLOBALTYPES.ALERT,\n      payload: {\n        error: err.response.data.msg\n      }\n    });\n  }\n};\nexport const getPost = _ref => {\n  let {\n    detailPost,\n    id,\n    auth\n  } = _ref;\n  return async dispatch => {\n    if (detailPost.every(post => post._id !== id)) {\n      try {\n        const res = await getDataAPI(`post/${id}`, auth.token);\n        dispatch({\n          type: POST_TYPES.GET_POST,\n          payload: res.data.post\n        });\n      } catch (err) {\n        dispatch({\n          type: GLOBALTYPES.ALERT,\n          payload: {\n            error: err.response.data.msg\n          }\n        });\n      }\n    }\n  };\n};\nexport const deletePost = _ref2 => {\n  let {\n    post,\n    auth\n  } = _ref2;\n  return async dispatch => {\n    dispatch({\n      type: POST_TYPES.DELETE_POST,\n      payload: post\n    });\n\n    try {\n      await deleteDataAPI(`post/${post._id}`, auth.token);\n    } catch (err) {\n      dispatch({\n        type: GLOBALTYPES.ALERT,\n        payload: {\n          error: err.response.data.msg\n        }\n      });\n    }\n  };\n};","map":{"version":3,"sources":["C:/Users/ASUS/Desktop/University/I.T/Year 1/Software Engineering Project Management/Project/real/client/src/redux/actions/postAction.js"],"names":["GLOBALTYPES","imageUpload","getDataAPI","postDataAPI","patchDataAPI","deleteDataAPI","axios","POST_TYPES","CREATE_POST","LOADING_POST","GET_POSTS","UPDATE_POST","GET_POST","DELETE_POST","createPost","data","images","auth","dispatch","media","type","ALERT","payload","loading","length","token","newData","res","newPost","user","success","msg","err","error","response","getPosts","getAllPosts","get","updatePost","status","imgNewURL","filter","img","url","imgOldURL","_id","console","log","getPost","detailPost","id","every","post","deletePost"],"mappings":"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","sourcesContent":["import { GLOBALTYPES } from \"./globalTypes\"\r\nimport { imageUpload } from \"../../utils/imgUpload\"\r\nimport { getDataAPI, postDataAPI, patchDataAPI, deleteDataAPI } from \"../../utils/fetchData\"\r\nimport axios from \"axios\"\r\n\r\nexport const POST_TYPES = {\r\n    CREATE_POST: 'CREATE_POST',\r\n    LOADING_POST: 'LOADING_POST',\r\n    GET_POSTS: 'GET_POSTS',\r\n    UPDATE_POST: 'UPDATE_POST',\r\n    GET_POST: 'GET_POST',\r\n    DELETE_POST: 'DELETE_POST'\r\n   \r\n}\r\n\r\nexport const createPost = (data, images, auth) => async(dispatch) => {\r\n    // console.log({data, images}, auth)\r\n\r\n    let media = []\r\n    \r\n    try {\r\n        dispatch({type: GLOBALTYPES.ALERT, payload: { loading: true }})\r\n\r\n        if(images.length > 0) media = await imageUpload(images, auth.token)\r\n        const newData = {...data, images: media}\r\n\r\n        const res = await postDataAPI('posts', newData, auth.token)\r\n        \r\n        dispatch({ \r\n            type: POST_TYPES.CREATE_POST, \r\n            payload: {...res.data.newPost, user: auth.user} \r\n        })\r\n\r\n        \r\n        dispatch({ type: GLOBALTYPES.ALERT, payload: {loading: false} })\r\n        dispatch({\r\n            type: GLOBALTYPES.ALERT, \r\n            payload: ({\r\n                success: res.data.msg\r\n            })\r\n        })\r\n        \r\n    } catch (err) {\r\n        dispatch({\r\n            type: GLOBALTYPES.ALERT, \r\n            payload: ({\r\n                error: err.response.data.msg\r\n            })\r\n        })\r\n    }\r\n}\r\n\r\nexport const getPosts = (token) => async(dispatch) => {\r\n    try {\r\n        dispatch({type: POST_TYPES.LOADING_POST, payload: { loading: true }})\r\n        const res = await getDataAPI('posts', token)\r\n        dispatch({\r\n            type: POST_TYPES.GET_POSTS,\r\n            payload: res.data\r\n        })\r\n\r\n        dispatch({ type: POST_TYPES.LOADING_POST, payload: {loading: false} })\r\n    } catch (err) {\r\n        dispatch({\r\n            type: GLOBALTYPES.ALERT, \r\n            payload: ({\r\n                error: err.response.data.msg\r\n            })\r\n        })\r\n    }\r\n}\r\n\r\nexport const getAllPosts = () => async(dispatch) => {\r\n    try {\r\n        dispatch({type: POST_TYPES.LOADING_POST, payload: { loading: true }})\r\n        const res = await axios.get(`/api/allposts`)\r\n        dispatch({\r\n            type: POST_TYPES.GET_POSTS,\r\n            payload: res.data\r\n        })\r\n\r\n        dispatch({ type: POST_TYPES.LOADING_POST, payload: {loading: false} })\r\n    } catch (err) {\r\n        dispatch({\r\n            type: GLOBALTYPES.ALERT, \r\n            payload: ({\r\n                error: err.response.data.msg\r\n            })\r\n        })\r\n    }\r\n}\r\n\r\n\r\nexport const updatePost = (data, images, auth, status) => async(dispatch) => {\r\n    let media = []\r\n\r\n    const imgNewURL = images.filter(img => !img.url)\r\n    const imgOldURL = images.filter(img => img.url)\r\n\r\n    if (status === data && imgNewURL.length === 0 && imgOldURL.length === status.images.length) return;\r\n    try {\r\n        dispatch({type: GLOBALTYPES.ALERT, payload: { loading: true }})\r\n        if(imgNewURL.length > 0) media = await imageUpload(imgNewURL, auth.token)\r\n        const newData = {...data, images: [...imgOldURL, ...media] }\r\n        \r\n        const res = await patchDataAPI(`post/${status._id}`, newData, auth.token)\r\n        console.log(res)\r\n        // dispatch({ \r\n        //     type: POST_TYPES.UPDATE_POST, \r\n        //     payload: {...res.data.newPost, user: auth.user} \r\n        // })\r\n\r\n\r\n        // dispatch({ type: GLOBALTYPES.ALERT, payload: {loading: false} })\r\n        // dispatch({\r\n        //     type: GLOBALTYPES.ALERT, \r\n        //     payload: ({\r\n        //         success: res.data.msg\r\n        //     })\r\n        // })\r\n    } catch (err) {\r\n        dispatch({\r\n            type: GLOBALTYPES.ALERT, \r\n            payload: ({\r\n                error: err.response.data.msg\r\n            })\r\n        })\r\n    }\r\n\r\n}\r\n\r\nexport const getPost = ({detailPost, id, auth}) => async(dispatch) => {\r\n    if (detailPost.every(post => post._id !== id)) {\r\n        try {\r\n            const res = await getDataAPI(`post/${id}`, auth.token)\r\n            dispatch({type: POST_TYPES.GET_POST, payload: res.data.post})\r\n        } catch (err) {\r\n            dispatch({\r\n                type: GLOBALTYPES.ALERT, \r\n                payload: ({\r\n                    error: err.response.data.msg\r\n                })\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nexport const deletePost = ({post, auth}) => async(dispatch) => {\r\n    dispatch({type: POST_TYPES.DELETE_POST, payload: post})\r\n\r\n    try {\r\n        await deleteDataAPI(`post/${post._id}`, auth.token)\r\n    } catch (err) {\r\n        dispatch({\r\n            type: GLOBALTYPES.ALERT, \r\n            payload: ({\r\n                error: err.response.data.msg\r\n            })\r\n        })\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}